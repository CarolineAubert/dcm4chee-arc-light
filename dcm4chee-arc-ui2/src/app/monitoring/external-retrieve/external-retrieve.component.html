<div class="main_content queues monitoring">
  <monitoring-tabs></monitoring-tabs>
  <div class="tab-content">
    <filter-generator [schema]="filterSchema" [model]="filterObject" (submit)="onSubmit($event)"></filter-generator>
    <table class="table table-bordered table-condensed" *ngIf="_.size(externalRetrieveEntries) > 0">
      <thead>
      <tr>
        <th colspan="2">
          <button class="btn btn-link btn-xs"
                  [disabled]="!hasNewer(externalRetrieveEntries)"
                  (click)="search(newerOffset(externalRetrieveEntries))"
                  title="Newer">
            <span class="glyphicon glyphicon-menu-left"></span>
          </button>
          <button class="btn btn-link btn-xs"
                  [disabled]="!hasOlder(externalRetrieveEntries)"
                  (click)="search(olderOffset(externalRetrieveEntries))"
                  title="Older">
            <span class="glyphicon glyphicon-menu-right"></span>
          </button>
        </th>
        <th>Modality</th>
        <th title="Number of instances">Nr.Inst. </th>
        <th title="Export Task ID">Exporter ID</th>
        <th>Status</th>
        <th>Failures</th>
        <th title="Scheduled time">Queue time</th>
        <th title="Processing start time">Export time</th>
        <th>Device name</th>
        <th>Study UID</th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let match of externalRetrieveEntries">
        <tr>
          <td [attr.rowspan]="(match.showProperties ? 2 : 1)" [innerHtml]="match.offset+1+'.'"></td>
          <td>
            <a (click)="$event.preventDefault();match.showProperties = !match.showProperties" href="" title="Show Properties">
              <span class="glyphicon glyphicon-list"></span>
            </a>
            <a *ngIf="isRole('admin') && ((match.properties.status && match.properties.status === 'SCHEDULED') || (match.properties.status && match.properties.status === 'IN PROCESS'))" (click)="$event.preventDefault();cancel(match)" href="" title="Cancel">
              <span class="glyphicon glyphicon-ban-circle"></span>
            </a>
            <a *ngIf="isRole('admin') && (match.properties.status && (match.properties.status === 'TO SCHEDULE' || match.properties.status === 'CANCELED' || match.properties.status === 'COMPLETED' || match.properties.status === 'FAILED'))" (click)="$event.preventDefault();reschedule(match)" href="" title="Reschedule">
              <span class="glyphicon glyphicon-repeat"></span>
            </a>
            <a *ngIf="isRole('admin')" (click)="$event.preventDefault();delete(match)" href="" title="Delete">
              <span class="glyphicon glyphicon-remove-circle"></span>
            </a>
          </td>
          <td [innerHtml]="match.properties.Modality"></td>
          <td [innerHtml]="match.properties.NumberOfInstances" ></td>
          <td [innerHtml]="match.properties.ExporterID"></td>
          <td [innerHtml]="match.properties.status" title="{{match.properties.outcomeMessage}}"></td>
          <td [innerHtml]="match.properties.failures" title="{{match.properties.errorMessage}}"></td>
          <td class="text-right" [innerHtml]="getDifferenceTime(match.properties.scheduledTime,match.properties.processingStartTime)"></td>
          <td class="text-right" [innerHtml]="getDifferenceTime(match.properties.processingStartTime,match.properties.processingEndTime)"></td>
          <td [innerHtml]="match.properties.dicomDeviceName"></td>
          <td [innerHtml]="match.properties.StudyInstanceUID"></td>
        </tr>
        <tr *ngIf="match.showProperties">
          <td colspan="11">
            <table class="table table-bordered table-condensed attribute_list">
              <tr *ngFor="let key of match.properties | getKey">
                <th [innerHtml]="key._KEY"></th>
                <td [innerHtml]="key._VALUE"></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr [hidden]="true"></tr>
      </ng-container>
      </tbody>
    </table>
  </div>
</div>