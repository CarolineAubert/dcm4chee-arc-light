<div class="main_content lifecycle_management">
    <monitoring-tabs></monitoring-tabs>
    <div class="tab-content">
        <div class="row filter">
            <div class="main_filter_block">
                <div class="col-md-3 block-1-1">
                    <div class="row">
                        <label class="col-md-6 text-right control-label">AET:</label>
                        <div class="col-md-6">
                            <md-select [(ngModel)]="aet" class="col-md-12">
                                <md-option *ngFor="let ae of aets" [value]="ae.title" title="{{ae.description}}">{{ ae.title }}</md-option>
                            </md-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input id="PatientName" type="text" [(ngModel)]="filters.PatientName" placeholder="Patient name" title="Patient name" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <label>
                                <input type="checkbox" [(ngModel)]="filters.fuzzymatching"> Fuzzy Matching
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input id="PatientID" type="text" [(ngModel)]="filters.PatientID" placeholder="Patient ID" title="Patient ID" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <input autocomplete="off" id="IssuerOfPatientID" [disabled]="disabled.IssuerOfPatientID" type="text" [(ngModel)]="filters.IssuerOfPatientID" placeholder="Issuer of patient" title="Issuer of patient" class="col-md-12" (click)="conditionWarning($event, !filters.PatientID, 'Patient ID is empty, set first the patient ID!')" (keyup)="conditionWarning($event, !filters.PatientID, 'Patient ID is empty, set first the patient ID!')" />
                        </div>
                    </div>
                </div>
                <div class="col-md-3 block-1-1">
                    <div class="row">
                        <div class="col-md-6">
                            <input id="AccessionNumber" type="text" [(ngModel)]="filters.AccessionNumber" placeholder="Accession number" title="Accession number" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <input id="LocalNamespaceEntityID" type="text" [disabled]="disabled.LocalNamespaceEntityID" [(ngModel)]="filters['IssuerOfAccessionNumberSequence.LocalNamespaceEntityID']" placeholder="Issuer of accession number" title="Issuer of accession number" class="col-md-12"  (keyup)="conditionWarning($event, !filters.AccessionNumber, 'Accession Number is empty, set first the Accession Number!')" (click)="conditionWarning($event, !filters.AccessionNumber, 'Accession Number is empty, set first the Accession Number!')"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input id="ReferringPhysicianName" type="text" [(ngModel)]="filters.ReferringPhysicianName" placeholder="Referring physician name" title="Referring physician name" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <input id="Modality" type="text" size="5"  [(ngModel)]="filters.ModalitiesInStudy" (click)="showModalitySelector = !showModalitySelector" placeholder="Modality"  class="col-md-12" ng-keypress="checkKeyModality($event)"/>
                            <div class="modality_selector [hidden]" *ngIf="showModalitySelector">
                                <a href="" (click)="showModalitySelector=false" class="close"><i class="glyphicon glyphicon-remove"></i></a>
                                <div class="common">
                                    <a href="" *ngFor="let value of modalities.common | getKey;" (click)="$event.preventDefault();selectModality(value._KEY)" title="{{value._VALUE}}">{{value._KEY}}</a>
                                </div>
                                <button (click)="filters.ModalitiesInStudy='';showModalitySelector=false;" class="clear custom_button">Clear</button>
                                <!-- <div class="col-md-12"></div> -->
                                <a href="" (click)="$event.preventDefault();showMore=true" *ngIf="!showMore" class="more">more<i class="glyphicon glyphicon-triangle-bottom"></i></a>
                                <a href="" (click)="$event.preventDefault();showMore=false" *ngIf="showMore" class="more">less<i class="glyphicon glyphicon-triangle-top"></i></a>
                                <div class="more_block" *ngIf="showMore">
                                    <a href="" *ngFor="let value of modalities.more | getKey;" (click)="$event.preventDefault();selectModality(value._KEY)" title="{{value._VALUE}}">{{value._KEY}}</a>
                                    <div class="form-group">
                                        <label>Custom modality code:</label>
                                        <input [(ngModel)]="filters.ModalitiesInStudy" />
                                        <button (click)="showModalitySelector=false" class="custom_button">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="limit" class="block_seid pull-right">Page Size:</label>
                        </div>
                        <div class="col-md-6">
                            <input  id="limit" type="number" min="1" [(ngModel)]="filters.limit" class="col-md-12" required/>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 block-1-2">
                    <div class="row">
                        <label for="StudyDateFrom" class="col-md-12">Start Date / Time:</label>
                    </div>
                    <div class="row datetime">
                        <div class="block_seid">
                            <div class="col-md-12">
                                <p-calendar dataType="string" [(ngModel)]="studyDate.from" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Start date from"></p-calendar>
                            </div>
                            <div class="col-md-12">
                                <p-calendar (onSelect)="selectTime('from')" (onBlur)="selectTime('from')" [(ngModel)]="studyTime.fromObject" timeOnly="true" hourFormat="24" placeholder="Start time from"></p-calendar>
                            </div>
                        </div>
                        <div class="minus text-center">
                            -
                        </div>
                        <div class="block_seid">
                            <div class="col-md-12">
                                <p-calendar dataType="string" [(ngModel)]="studyDate.to" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Start date to"></p-calendar>
                            </div>
                            <div class="col-md-12">
                                <p-calendar (onSelect)="selectTime('to')" [(ngModel)]="studyTime.toObject" timeOnly="true" hourFormat="24" placeholder="Start time to"></p-calendar>
                            </div>
                        </div>
                    </div>
                </div>
                <a class="clearform_button" title="Clear all filters" href="" (click)="$event.preventDefault();clearForm()">
                    Clear <span class="glyphicon glyphicon-remove"></span>
                </a>
                <div class="col-md-3 block-1-1 block_half">
                    <div class="row">
                    </div>
                    <div class="row">
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-default submit col-md-12" (click)="search()" title="Refresh">
                                <span class="glyphicon glyphicon-refresh"></span>
                                SUBMIT
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!--            <div class="diff_more_filters">
                            <a href="" (click)="$event.preventDefault();advancedConfig=true" *ngIf="!advancedConfig" class="more">Extended search<i class="glyphicon glyphicon-triangle-bottom"></i></a>
                            <a href="" (click)="$event.preventDefault();advancedConfig=false" *ngIf="advancedConfig" class="more ng-hide">Close extended search<i class="glyphicon glyphicon-triangle-top"></i></a>
                        </div>-->
            <div *ngIf="advancedConfig" class="ng-hide">
                <div class="row ng-hide filters hidden_filters" *ngIf="advancedConfig">
                    <div class="col-md-3 block-2-1" >
                        <div class="row">
                            <div class="col-md-6">
                                <input id="InstitutionName" type="text" [(ngModel)]="filters.InstitutionName" placeholder="Institution Name" title="Institution Name" class="col-md-12" />
                            </div>
                            <div class="col-md-6">
                                <input id="SendingApplicationEntityTitleOfSeries" type="text" [(ngModel)]="filters.SendingApplicationEntityTitleOfSeries" placeholder="Sending Application Entity Title of Series" title="Sending Application Entity Title of Series" class="col-md-12 clearable" />
                            </div>
                            <div class="col-md-6">
                                <input id="InstitutionalDepartmentName" type="text" [(ngModel)]="filters.InstitutionalDepartmentName" placeholder="Institutional Department Name" title="Institutional Department Name" class="col-md-12 clearable" />
                            </div>
                            <div class="col-md-6">
                                <input id="StationName" type="text" [(ngModel)]="filters.StationName" placeholder="Station Name" title="Station Name" class="col-md-12" />
                            </div>
                            <div class="col-md-6">
                                <input id="SOPClassesInStudy" type="text" [(ngModel)]="filters.SOPClassesInStudy" placeholder="SOP classes in study" title="SOP classes in study" class="col-md-12 clearable" />
                            </div>
                            <div class="col-md-6">
                                <input id="SeriesDescription" type="text" [(ngModel)]="filters.SeriesDescription" placeholder="Series Description" title="Series Description" class="col-md-12 clearable" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 block-2-1">
                        <div class="row">
                            <div class="col-md-6">
                                <input id="StudyID" type="text" [(ngModel)]="filters.StudyID" placeholder="StudyID" title="study._VALUE ID" class="col-md-12" />
                            </div>
                            <div class="col-md-6">
                                <input id="StudyInstanceUID" type="text" [(ngModel)]="filters.StudyInstanceUID" placeholder="Study Instance UID" title="study._VALUE instance UID" class="col-md-12 clearable" />
                            </div>
                            <div class="col-md-6">
                                <input id="StudyDescription" type="text" [(ngModel)]="filters.StudyDescription" placeholder="Study Description" title="study._VALUE description" class="col-md-12" />
                            </div>
                            <div class="col-md-6">
                                <input id="BodyPartExamined" type="text" [(ngModel)]="filters.BodyPartExamined" placeholder="Body Part Examined" title="Body Part Examined" class="col-md-12 clearable" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="checkboxpart">
                                        <input type="checkbox" [(ngModel)]="ExternalRetrieveAETchecked" (change)="filters.ExternalRetrieveAET = '';filters['ExternalRetrieveAET!'] = ''"> No
                                    </span>
                                    <input class="col-md-12 clearable inputpart" id="ExternalRetrieveAET" *ngIf="!ExternalRetrieveAETchecked" type="text" [(ngModel)]="filters.ExternalRetrieveAET" placeholder="External retrieve AET" title="Retrievable from external retrieve AET" />
                                    <input class="col-md-12 clearable inputpart" id="ExternalRetrieveAET!" *ngIf="ExternalRetrieveAETchecked" type="text" [(ngModel)]="filters['ExternalRetrieveAET!']" placeholder="External retrieve AET" title="Not retrievable from external retrieve AET"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 block-1-1">
                        <div class="row">
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label>
                                    Study created date/time:
                                </label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p-calendar (ngModelChange)="studyReceiveDateTimeChanged($event,'from')" [(ngModel)]="StudyReceiveDateTime.from" dateFormat="yy-mm-dd"  showTime="showTime" hourFormat="24" placeholder="from"></p-calendar>
                            </div>
                            <div class="col-md-6">
                                <p-calendar (ngModelChange)="studyReceiveDateTimeChanged($event,'to')" [(ngModel)]="StudyReceiveDateTime.to" dateFormat="yy-mm-dd"  showTime="showTime" hourFormat="24" placeholder="to"></p-calendar>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main_filter_block">
                <div class="morefunctionblock">
                    <a href="" (click)="$event.preventDefault();advancedConfig=true" *ngIf="!advancedConfig" class="more">More filters<i class="glyphicon glyphicon-triangle-bottom"></i></a>
                    <a href="" (click)="$event.preventDefault();advancedConfig=false" *ngIf="advancedConfig" class="more [hidden]">Close more filters<i class="glyphicon glyphicon-triangle-top"></i></a>
                    <div class="more functions">
                        <div class="mainbutton" (click)="moreFunctionsButtons = !moreFunctionsButtons">
                            <span *ngIf="!moreFunctionsButtons" >More configurations<i class="glyphicon glyphicon-triangle-bottom"></i></span>
                            <span *ngIf="moreFunctionsButtons">More configurations<i class="glyphicon glyphicon-triangle-top"></i></span>
                        </div>
                        <ul *ngIf="moreFunctionsButtons">
                            <li (click)="moreFunctionsButtons = false;addRetentionPolicy()" title="Set the C-MOVE SCP and STORE-SCP AETs">Add Study Retention Policy</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="float_content">
            <h2>
                Lifecycle management
            </h2>
            <div class="bluebar" (click)="toggleBar('config')">
                <span class="pull-left" >Lifecycle management configuration</span>
                <span class="pull-right" *ngIf="StudyRetentionPolicy?.length">{{StudyRetentionPolicy?.length}}</span>
            </div>
            <div class="bluecontent config" *ngIf="toggle === 'config' && StudyRetentionPolicy?.length">
                <div class="dynamic_table ">
                    <!--<dynamic-form [formelements]="formObj" [model]="model" (submitFunction)="submitFunction($event)"></dynamic-form>-->
                    <div class="dynamic_table ">
                        <div class="table_header">
                            <div class="th" *ngFor="let header of retentionPolicyTable" title="{{header.description}}" [ngStyle]="{width: header.calculatedWidth}">
                                <ng-container *ngIf="header.code != 'menu'">
                                    {{header.title}}
                                </ng-container>
                                <ng-container *ngIf="header.code === 'menu'">
                                    &nbsp;
                                </ng-container>
                            </div>
                        </div>
                        <div class="table_body">
                            <div class="tr" *ngFor="let retention of StudyRetentionPolicy">
                                <div class="td" *ngFor="let table_element of retentionPolicyTable;let index = index" [ngStyle]="{width: table_element.calculatedWidth}">
                                    <ng-container *ngIf="table_element.code != 'menu'">
                                        <span *ngIf="_.hasIn(retention,[table_element.code])">{{retention[table_element.code] || ''}}</span>
                                    </ng-container>
                                    <ng-container *ngIf="table_element.code === 'menu'">
                                        <a title="Edit retention policy" (click)="editRetentionPolicy(retention,index)"><i class="material-icons">create</i></a>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bluecontent config no_data" *ngIf="toggle === 'config' && (!StudyRetentionPolicy || (StudyRetentionPolicy.length && StudyRetentionPolicy.length === 0))">
                <h3>No configuration found,<a (click)="$event.preventDefault();addRetentionPolicy()"> click here to add one</a></h3>
            </div>
            <div class="bluebar" (click)="toggleBar('expired')">
                <span class="pull-left" >Expired studies</span>
                <span class="pull-right" *ngIf="expiredStudies?.length">{{expiredStudies?.length}}</span>
            </div>
            <div class="bluecontent expired" *ngIf="toggle === 'expired' && expiredStudies?.length">
                <div class="dynamic_table ">
                    <div class="table_header">
                        <div class="th" *ngFor="let header of table" title="{{header.description}}" [ngStyle]="{width: header.calculatedWidth}">
                            <ng-container *ngIf="header.code != 'menu'">
                                {{header.title}}
                            </ng-container>
                            <ng-container *ngIf="header.code === 'menu'">
                                &nbsp;
                            </ng-container>
                        </div>
                    </div>
                    <div class="table_body">
                        <div class="tr" *ngFor="let study of expiredStudies">
                            <div class="td" *ngFor="let table_element of table" [ngStyle]="{width: table_element.calculatedWidth}">
                                <ng-container *ngIf="table_element.code != 'menu'">
                                    <span *ngIf="_.hasIn(study[table_element.code],'Value[0].Alphabetic')">{{study[table_element.code]?.Value[0].Alphabetic || ''}}</span>
                                    <span *ngIf="!_.hasIn(study[table_element.code],'Value[0].Alphabetic') && _.hasIn(study[table_element.code],'Value[0]')">{{study[table_element.code]?.Value[0] || ''}}</span>
                                </ng-container>
                                <ng-container *ngIf="table_element.code === 'menu'">
                                    <a title="Change expired date" (click)="setExpiredDate(study)"><i class="material-icons">history</i></a>
                                    <!--<a title="Change expired date" (click)="setExpiredDate(study)"><i class="material-icons">done</i></a>-->
                                    <a title="Lock the study by adding as expired date 31.12.9999" (click)="setInfinitExpiredDate(study)"><i class="material-icons">lock</i></a>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bluecontent expired no_data" *ngIf="toggle === 'expired' && (!expiredStudies || (expiredStudies.length && expiredStudies.length === 0))">
                <h3>No expired studies found, change the filters and try again!</h3>
            </div>
            <div class="bluebar" (click)="toggleBar('all')">
                <span class="pull-left" >All studies</span>
                <span class="pull-right" *ngIf="allStudies?.length">{{allStudies?.length}}</span>
            </div>
            <div class="bluecontent all" *ngIf="toggle === 'all' && allStudies?.length">
                <div class="dynamic_table ">
                    <div class="table_header">
                        <div class="th" *ngFor="let header of table" title="{{header.description}}" [ngStyle]="{width: header.calculatedWidth}">
                            <ng-container *ngIf="header.code != 'menu'">
                                {{header.title}}
                            </ng-container>
                            <ng-container *ngIf="header.code === 'menu'">
                                &nbsp;
                            </ng-container>
                        </div>
                    </div>
                    <div class="table_body">
                        <div class="tr" *ngFor="let study of allStudies">
                            <div class="td" *ngFor="let table_element of table" [ngStyle]="{width: table_element.calculatedWidth}">
                                <ng-container *ngIf="table_element.code != 'menu'">
                                    <span *ngIf="_.hasIn(study[table_element.code],'Value[0].Alphabetic')">{{study[table_element.code]?.Value[0].Alphabetic || ''}}</span>
                                    <span *ngIf="!_.hasIn(study[table_element.code],'Value[0].Alphabetic') && _.hasIn(study[table_element.code],'Value[0]')">{{study[table_element.code]?.Value[0] || ''}}</span>
                                </ng-container>
                                <ng-container *ngIf="table_element.code === 'menu'">
                                    <a title="Set expired date" (click)="setExpiredDate(study)"><i class="material-icons">history</i></a>
                                    <!--<a title="Change expired date" (click)="setExpiredDate(study)"><i class="material-icons">done</i></a>-->
                                    <a title="Lock the study by adding as expired date 31.12.9999" (click)="setInfinitExpiredDate(study)"><i class="material-icons">lock</i></a>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>