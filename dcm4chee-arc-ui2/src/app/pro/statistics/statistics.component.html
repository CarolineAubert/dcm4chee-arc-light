
<div class="main_content queues monitoring statistics">
    <monitoring-tabs></monitoring-tabs>
    <div class="tab-content">
        <div class="row filter">
            <div class="main_filter_block">
                <div class="col-md-3 block-1-1">
                    <div class="row">
                        <label class="col-md-6 control-label">Time range</label>
                        <label class="col-md-6 control-label">Date/time:</label>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-radio submit col-md-12" title="Refresh" (click)="changeActiveTimeRange('quick')"
                                    [ngClass]="{active: activeTimeRange === 'quick'}">Quick</button>
                        </div>
                        <div class="col-md-6" title="Start date/time">
                            <p-calendar
                                    *ngIf="activeTimeRange === 'absolute'"
                                    [(ngModel)]="range.from"
                                    dateFormat="yy-mm-dd"
                                    showTime="showTime"
                                    hourFormat="24"
                                    monthNavigator="true"
                                    yearNavigator="true"
                                    yearRange="1800:2100"
                                    placeholder="Start date/time"
                                    (ngModelChange)="studyDateTimeChanged($event,'from')"
                            ></p-calendar>
                            <md-select *ngIf="activeTimeRange === 'quick'" [(ngModel)]="quickMode" (change)="quickDateChange($event)" placeholder="Quick time range" floatPlaceholder="never">
                                <md-option value="{{modes.value}}" *ngFor="let modes of quickModeOptions">{{modes.label}}</md-option>
                            </md-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-radio submit col-md-12" [ngClass]="{active: activeTimeRange === 'absolute'}" (click)="changeActiveTimeRange('absolute')" title="Refresh">Absolute</button>
                        </div>
                        <div class="col-md-6" title="End date/time">
                            <p-calendar
                                    *ngIf="activeTimeRange === 'absolute'"
                                    [(ngModel)]="range.to"
                                    dateFormat="yy-mm-dd"
                                    showTime="showTime"
                                    hourFormat="24"
                                    monthNavigator="true"
                                    yearNavigator="true"
                                    yearRange="1800:2100"
                                    placeholder="End date/time"
                                    (ngModelChange)="studyDateTimeChanged($event,'to')"
                            ></p-calendar>

                        </div>
                    </div>
                </div>
                <div class="col-md-3 block-1-1 block_half">
                    <div class="row"></div>
                    <div class="row">
                        <div class="col-md-12">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-default submit col-md-12" (click)="search()" title="Refresh">
                                <span class="glyphicon glyphicon-refresh"></span>
                                SUBMIT
                            </button>
                        </div>
                    </div>
                </div>
                <a class="clearform_button" title="Clear all filters" href="" (click)="$event.preventDefault();clearForm()">
                    Clear <span class="glyphicon glyphicon-remove"></span>
                </a>
            </div>
        </div>
        <div class="statistics_content" *ngIf="elasticSearchIsRunning">
            <div class="count_block_row">
                <div class="count_block">
                    <h3>{{queries.label}}</h3>
                    <label *ngIf="queries.count != undefined">{{queries.count}}</label>
                </div>
                <div class="count_block">
                    <h3>{{retriev.label}}</h3>
                    <label *ngIf="retriev.count != undefined">{{retriev.count}}</label>
                </div>
                <div class="count_block">
                    <h3>{{studieStored.label}}</h3>
                    <label *ngIf="studieStored.count != undefined">{{studieStored.count}}</label>
                </div>
                <div class="count_block pointer" (click)="showErrors()">
                    <h3 class="pointer">{{errors.label}}</h3>
                    <label class="pointer" *ngIf="errors.count != undefined" [ngClass]="{'text-danger': errors.count}">{{errors.count}}</label>
                </div>
                <div class="count_block">
                    <h3>{{wildflError.label}}</h3>
                    <label *ngIf="wildflError.count != undefined" [ngClass]="{'text-danger': wildflError.count}">{{wildflError.count}}</label>
                </div>
            </div>
            <div class="table_block">
                <div class="header" (click)="toggleBlock('USERIDQUERIES',$event)">
                    <h3>Queries / User ID</h3>
                </div>
                <div class="diagram_content" *ngIf="toggle === 'USERIDQUERIES' && histogramData.querieUserID.ready.labels.length > 0">
                    <canvas baseChart
                            *ngIf="histogramData.querieUserID.show"
                            [datasets]="histogramData.querieUserID.ready.data"
                            [labels]="histogramData.querieUserID.ready.labels"
                            [options]="histogramData.querieUserID.chartOptions"
                            [colors]="pieChartColor"
                            [legend]="barChartLegend"
                            [chartType]="barChartType"
                            (chartHover)="chartHovered($event)"
                            (chartClick)="chartClicked($event)"></canvas>
                </div>
                <div class="diagram_content no_data" *ngIf="toggle === 'USERIDQUERIES' && histogramData.querieUserID.ready && histogramData.querieUserID.ready.labels.length === 0">
                    <h3>{{histogramData.querieUserID.noDataText}}</h3>
                </div>
            </div>
            <div class="table_block">
                <div class="header" (click)="toggleBlock('USERIDRETRIEVES',$event)">
                    <h3>Retrieves / User ID</h3>
                </div>
                <div class="diagram_content" *ngIf="toggle === 'USERIDRETRIEVES' && histogramData.retrievesUserID.ready && histogramData.retrievesUserID.ready.labels.length > 0">
                    <canvas baseChart
                            *ngIf="histogramData.retrievesUserID.show"
                            [datasets]="histogramData.retrievesUserID.ready.data"
                            [labels]="histogramData.retrievesUserID.ready.labels"
                            [options]="histogramData.retrievesUserID.chartOptions"
                            [colors]="pieChartColor"
                            [legend]="barChartLegend"
                            [chartType]="barChartType"
                            (chartHover)="chartHovered($event)"
                            (chartClick)="chartClicked($event)"></canvas>
                </div>
                <div class="diagram_content no_data" *ngIf="toggle === 'USERIDRETRIEVES' && histogramData.retrievesUserID.ready.labels.length === 0">
                    <h3>{{histogramData.retrievesUserID.noDataText}}</h3>
                </div>
            </div>
            <div class="table_block">
                <div class="header" (click)="toggleBlock('STUDYSOPCLASS',$event)">
                    <h3>Studies Stored / SOP Class</h3>
                </div>
                <div class="diagram_content" *ngIf="toggle === 'STUDYSOPCLASS' && histogramData.studyStoredSopClass.ready && histogramData.studyStoredSopClass.ready.labels.length > 0">
                    <canvas baseChart
                            *ngIf="histogramData.studyStoredSopClass.show"
                            [datasets]="histogramData.studyStoredSopClass.ready.data"
                            [labels]="histogramData.studyStoredSopClass.ready.labels"
                            [options]="histogramData.studyStoredSopClass.chartOptions"
                            [colors]="pieChartColor"
                            [legend]="barChartLegend"
                            [chartType]="barChartType"
                            (chartHover)="chartHovered($event)"
                            (chartClick)="chartClicked($event)"></canvas>
                </div>
                <div class="diagram_content no_data" *ngIf="toggle === 'STUDYSOPCLASS' && histogramData.studyStoredSopClass.ready.labels.length === 0">
                    <h3>{{histogramData.studyStoredSopClass.noDataText}}</h3>
                </div>
            </div>
            <div class="table_block">
                <div class="header" (click)="toggleBlock('STUDYUSERID',$event)">
                    <h3>Studies Stored / User ID</h3>
                </div>
                <div class="diagram_content" *ngIf="toggle === 'STUDYUSERID' && histogramData.studyStoredUserID.ready && histogramData.studyStoredUserID.ready.labels.length > 0">
                    <canvas baseChart
                            *ngIf="histogramData.studyStoredUserID.show"
                            [datasets]="histogramData.studyStoredUserID.ready.data"
                            [labels]="histogramData.studyStoredUserID.ready.labels"
                            [options]="histogramData.studyStoredUserID.chartOptions"
                            [colors]="pieChartColor"
                            [legend]="barChartLegend"
                            [chartType]="barChartType"
                            (chartHover)="chartHovered($event)"
                            (chartClick)="chartClicked($event)"></canvas>
                </div>
                <div class="diagram_content no_data" *ngIf="toggle === 'STUDYUSERID' && histogramData.studyStoredUserID.ready.labels.length === 0">
                    <h3>{{histogramData.studyStoredUserID.noDataText}}</h3>
                </div>
            </div>
            <div class="table_block">
                <div class="header" (click)="toggleBlock('STUDYRECEIVINGAET',$event)">
                    <h3>Studies Stored / Receiving AET</h3>
                </div>
                <div class="diagram_content" *ngIf="toggle === 'STUDYRECEIVINGAET' && histogramData.studyStoredReceivingAET.ready && histogramData.studyStoredReceivingAET.ready.labels.length > 0">
                    <canvas baseChart
                            *ngIf="histogramData.studyStoredReceivingAET.show"
                            [datasets]="histogramData.studyStoredReceivingAET.ready.data"
                            [labels]="histogramData.studyStoredReceivingAET.ready.labels"
                            [options]="histogramData.studyStoredReceivingAET.chartOptions"
                            [colors]="pieChartColor"
                            [legend]="barChartLegend"
                            [chartType]="barChartType"
                            (chartHover)="chartHovered($event)"
                            (chartClick)="chartClicked($event)"></canvas>
                </div>
                <div class="diagram_content no_data" *ngIf="toggle === 'STUDYRECEIVINGAET' && histogramData.studyStoredReceivingAET.ready.labels.length === 0">
                    <h3>{{histogramData.studyStoredReceivingAET.noDataText}}</h3>
                </div>
            </div>
            <div class="table_block" id="auditevents">
                <div class="header" (click)="toggleBlock('AUDITEVENTS',$event)">
                    <h3>Audit Events</h3>
                    <input *ngIf="toggle === 'AUDITEVENTS'" type="text" [(ngModel)]="searchlist" placeholder="Search...">
                </div>
                <div class="table_content" *ngIf="toggle === 'AUDITEVENTS' && auditEvents && auditEvents.length > 0">
                    <table class="table table-bordered table-condensed">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Time</th>
                                <th>AuditSourceID</th>
                                <th>EventID</th>
                                <th>EventActionCode</th>
                                <th>Patient ParticipantObjectName</th>
                                <th>Study ParticipantObjectID</th>
                                <th>AccessionNumber</th>
                                <th>Source UserID</th>
                                <th>Requestor UserID</th>
                                <th>EventOutcomeIndicator</th>
                            </tr>
                        </thead>
                        <tbody>
                        <ng-container *ngFor="let item of auditEvents | search:searchlist | slice:moreAudit.start:moreAudit.limit">
                            <tr (click)="detailView(item)">
                                <td class="pointer"><span class="glyphicon glyphicon-th-list"></span></td>
                                <td>{{item.Time | date:'yyyy.MM.dd HH:mm:ss'}}</td>
                                <td tooltip="{{item.AuditSourceID}}">{{item.AuditSourceID | trim:14}}</td>
                                <td tooltip="{{item.EventID}}">{{item.EventID | trim:20}}</td>
                                <td>{{item.ActionCode}}</td>
                                <td tooltip="{{item.Patient}}">{{item.Patient | trim:20}}</td>
                                <td tooltip="{{item.Study}}">{{item.Study |trim:40}}</td>
                                <td tooltip="{{item.AccessionNumber}}">{{item.AccessionNumber|trim:15}}</td>
                                <td tooltip="{{item.userId}}">{{item.userId |trim:15}}</td>
                                <td>{{item.requestorId}}</td>
                                <td>{{item.EventOutcomeIndicator.text}}</td>
                            </tr>
                            <tr *ngIf="item.showDetail">
                                <td colspan="11">
                                    <table class="table table-bordered table-condensed subtable" width="100%">
                                        <tr *ngFor="let objectKeys of Object.keys(item.wholeObject)">
                                            <td>{{objectKeys}}</td>
                                            <td>{{item.wholeObject[objectKeys]}}</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </ng-container>
                        </tbody>
                    </table>
                </div>
                <button class="load_more" *ngIf="auditEvents && moreAudit.limit <= auditEvents.length && toggle === 'AUDITEVENTS'" (click)="loadMoreAudit()"><i *ngIf="moreAudit.loaderActive" class="fa fa-spinner fa-spin fa-3x fa-fw"></i>More</button>
            </div>
        </div>
        <div class="statistics_content no_data" *ngIf="!elasticSearchIsRunning">
            <h3 class="text-center text-danger">Unable to connect to Elasticsearch!</h3>
        </div>
    </div>
</div>